@page "/stats"
@inject IStatsService StatsService
@inject ISeasonService SeasonService
 @inject ILocalStorageService LocalStorage
@inject NavigationManager NavigationManager


@if (_playerStats != null)
{
    <div class="stats-page container py-4">
        <div class="stats-header mb-4">
            <h1 class="h3 mb-1"><i class="bi bi-bar-chart me-2"></i>Estatísticas</h1>
            <p class="text-muted mb-0">Média de jogadores por temporada</p>
        </div>

        <div class="stats-filters mb-3">
            <select class="form-select stats-filter-select" @onchange="HandlePositionChange">
                <option value="">Todas as posições</option>
                @foreach (string pos in positions)
                {
                    <option value="@pos">@pos</option>
                }
            </select>
            <select class="form-select stats-filter-select" @onchange="HandleYearChange">
                <option value="">Todas as temporadas</option>
                @foreach (var year in _seasonsList)
                {
                    <option value="@year.Year">@year.Year</option>
                }
            </select>
            <select class="form-select stats-filter-select" @onchange="HandleSizeChange">
                <option value="">Limite da lista</option>
                @foreach (var item in limit)
                {
                    <option value="@item">@item</option>
                }
            </select>
        </div>

        <div class="stats-table-container">
            <div class="table-responsive">
                <table class="table stats-table" id="statsTable">
                    <thead>
                        <tr>
                            <th class="col-player">JOGADOR</th>
                            <th>TIME</th>
                          
                    <th @onclick='() => SortTable("GP")'>GP
                        <i class="bi @GetSortIcon("GP")"></i>
                    </th>
                          
                    <th @onclick='() => SortTable("MIN")'>MPG
                        <i class="bi @GetSortIcon("MIN")"></i>
                    </th>
                          
                    <th @onclick='() => SortTable("PPG")'>PPG
                        <i class="bi @GetSortIcon("PPG")"></i>
                    </th>
                          
                    <th @onclick='() => SortTable("APG")'>APG
                        <i class="bi @GetSortIcon("APG")"></i>
                    </th>
                          
                    <th @onclick='() => SortTable("RPG")'>RPG
                        <i class="bi @GetSortIcon("RPG")"></i>
                    </th>
                            
                    <th @onclick='() => SortTable("ORB")'>ORB
                        <i class="bi @GetSortIcon("ORB")"></i>
                    </th>
                            
                    <th @onclick='() => SortTable("DRB")'>DRB
                        <i class="bi @GetSortIcon("DRB")"></i>
                    </th>
                             
                    <th @onclick='() => SortTable("SPG")'>SPG
                        <i class="bi @GetSortIcon("SPG")"></i>
                    </th>
                             
                    <th @onclick='() => SortTable("BPG")'>BPG
                        <i class="bi @GetSortIcon("BPG")"></i>
                    </th>
                             
                    <th @onclick='() => SortTable("TPG")'>TPG
                        <i class="bi @GetSortIcon("TPG")"></i>
                    </th>
                                       
                    <th @onclick='() => SortTable("FPG")'>FPG
                        <i class="bi @GetSortIcon("FPG")"></i>
                    </th>
                             
                    <th @onclick='() => SortTable("FG%")'>FG%
                        <i class="bi @GetSortIcon("FG%")"></i>
                    </th>
                             
                    <th @onclick='() => SortTable("FT%")'>FT%
                        <i class="bi @GetSortIcon("FT%")"></i>
                    </th>
                         
                    <th @onclick='() => SortTable("3P%")'>3P%
                        <i class="bi @GetSortIcon("3P%")"></i>
                    </th>
                              
                    <th @onclick='() => SortTable("TS%")'>TS%
                        <i class="bi @GetSortIcon("TS%")"></i>
                    </th>
                            
                        </tr>
                    </thead>
                    <tbody>
                    @foreach (var stats in _playerStats)
                    {
                        <tr>
                            <td class="col-player">
                                <div class="stats-player-cell">
                                    <img src="@(string.IsNullOrEmpty(stats.ImgUrl) ? "Images/Utils/blank.png" : stats.ImgUrl)" alt="" class="stats-player-thumb" />
                                    <a href="@($"players/{stats.PlayerId}")" class="stats-player-name">@stats.Name</a>
                                    <span class="stats-player-pos">@stats.Pos</span>
                                </div>
                            </td>
                            <td><img src="@($"../Images/Logos/{stats.TeamAbrv}.svg")" alt="" class="stats-team-logo" /></td>
                            <td>@stats.Games</td>
                            <td>@stats.MinPG</td>
                            <td>@stats.PtsPG</td>
                            <td>@stats.AstPG</td>
                            <td>@stats.TRebPG</td>
                            <td>@stats.ORebPG</td>
                            <td>@stats.DRebPG</td>
                            <td>@stats.StlPG</td>
                            <td>@stats.BlkPG</td>
                            <td>@stats.TovPG</td>
                            <td>@stats.PfPG</td>
                            <td>@stats.FgPct</td>
                            <td>@stats.FtPct</td>
                            <td>@stats.TpPct</td>
                            <td>@stats.TrueShooting</td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>
        </div>

        <div class="d-flex justify-content-center mt-4">
            <Pagination ActivePageNumber="_currentPage"
                        TotalPages="@_statsResponse.Pages"
                        PageChanged="ChangePage" />
        </div>
    </div>
}
else
{
    <Loading></Loading>
}